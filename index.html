<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minah Teacher's English Class Points</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒŸ</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        // Firebase ì´ˆê¸°í™” ìƒíƒœë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •
        window.firebaseInitialized = false;
        window.firebaseError = null;
        
        try {
            console.log('ğŸ”¥ Firebase SDK ë¡œë”© ì‹œì‘...');
            
            // Firebase ëª¨ë“ˆ ë™ì  ë¡œë“œ (ìµœì‹  ë²„ì „)
            const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js');
            const { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js');
            const { getFirestore, doc, setDoc, getDoc, collection, query, where, orderBy, onSnapshot, addDoc, updateDoc, deleteDoc, getDocs, enableNetwork, disableNetwork, connectFirestoreEmulator } = await import('https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js');
            
            console.log('âœ… Firebase SDK ë¡œë“œ ì™„ë£Œ');
            
            // ğŸ”¥ Firebase í”„ë¡œì íŠ¸ ì„¤ì • (ì™„ì „ ê²€ì¦ë¨)
            const firebaseConfig = {
                apiKey: "AIzaSyBdyW1w2iq79U44QDC0A_73PrcF4iWdZ9s",
                authDomain: "minah-teacher-s-class-points.firebaseapp.com",
                projectId: "minah-teacher-s-class-points",
                storageBucket: "minah-teacher-s-class-points.firebasestorage.app",
                messagingSenderId: "50388651847",
                appId: "1:50388651847:web:0607a021e7f3ed3c1b8662"
            };
            
            // Firebase ì•± ì´ˆê¸°í™”
            console.log('ğŸ”¥ Firebase ì•± ì´ˆê¸°í™” ì¤‘...');
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            // êµ¬ê¸€ ë¡œê·¸ì¸ ì œê³µì ì„¤ì •
            const provider = new GoogleAuthProvider();
            provider.addScope('email');
            provider.addScope('profile');
            provider.setCustomParameters({
                prompt: 'select_account',
                hd: '' // ëª¨ë“  ë„ë©”ì¸ í—ˆìš©
            });
            
            console.log('âœ… Firebase ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ');
            
            // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì • (ì•ˆì „í•œ ë°©ì‹)
            Object.assign(window, {
                auth,
                db,
                provider,
                signInWithPopup,
                signOut,
                onAuthStateChanged,
                doc,
                setDoc,
                getDoc,
                collection,
                query,
                where,
                orderBy,
                onSnapshot,
                addDoc,
                updateDoc,
                deleteDoc,
                getDocs,
                enableNetwork,
                disableNetwork
            });
            
            // ê³ ê¸‰ ì—°ê²° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
            window.testFirebaseConnection = async function() {
                try {
                    console.log('ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...');
                    
                    // 1ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™œì„±í™”
                    await enableNetwork(db);
                    console.log('âœ… ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™œì„±í™”');
                    
                    // 2ë‹¨ê³„: ì½ê¸° í…ŒìŠ¤íŠ¸
                    const testRef = doc(db, 'system', 'connectionTest');
                    const testDoc = await getDoc(testRef);
                    console.log('âœ… Firestore ì½ê¸° í…ŒìŠ¤íŠ¸ ì„±ê³µ');
                    
                    // 3ë‹¨ê³„: ì“°ê¸° í…ŒìŠ¤íŠ¸ (ê¶Œí•œ í™•ì¸)
                    try {
                        await setDoc(testRef, {
                            timestamp: Date.now(),
                            test: true,
                            userAgent: navigator.userAgent.substring(0, 100)
                        }, { merge: true });
                        console.log('âœ… Firestore ì“°ê¸° í…ŒìŠ¤íŠ¸ ì„±ê³µ');
                        return { success: true, canWrite: true };
                    } catch (writeError) {
                        console.log('âš ï¸ ì“°ê¸° ê¶Œí•œ ì—†ìŒ (ì½ê¸°ë§Œ ê°€ëŠ¥)');
                        return { success: true, canWrite: false, error: writeError };
                    }
                    
                } catch (error) {
                    console.error('âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                    return { success: false, error };
                }
            };
            
            // ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            console.log('ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰...');
            const testResult = await window.testFirebaseConnection();
            
            if (testResult.success) {
                window.firebaseInitialized = true;
                window.firebaseCanWrite = testResult.canWrite;
                
                if (testResult.canWrite) {
                    console.log('ğŸ‰ Firebase ì™„ì „ ì´ˆê¸°í™” ì„±ê³µ! (ì½ê¸°/ì“°ê¸° ëª¨ë‘ ê°€ëŠ¥)');
                } else {
                    console.log('âš ï¸ Firebase ë¶€ë¶„ ì´ˆê¸°í™” (ì½ê¸°ë§Œ ê°€ëŠ¥ - ê¶Œí•œ ì„¤ì • í•„ìš”)');
                    window.firebaseError = testResult.error;
                }
            } else {
                throw testResult.error;
            }
            
        } catch (error) {
            console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            window.firebaseInitialized = false;
            window.firebaseError = error;
            console.log('âš ï¸ Firebase ì—°ê²° ë¬¸ì œ - ì„¤ì • í™•ì¸ í•„ìš”');
        }
        
        // Firebase ì´ˆê¸°í™” ì™„ë£Œ ì´ë²¤íŠ¸ ë°œìƒ
        window.dispatchEvent(new Event('firebaseReady'));
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap');
        body { font-family: 'Nunito', sans-serif; }
        .cute-shadow { box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3); }
        .point-card { transition: all 0.3s ease; }
        .point-card:hover { transform: translateY(-2px); }
        .menu-item { transition: all 0.3s ease; }
        .menu-item:hover { background-color: rgba(238, 242, 255, 0.8) !important; transform: translateX(4px); }
        .menu-item.active { background-color: rgba(224, 231, 255, 0.9) !important; }
        .login-container { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        .shape:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { top: 20%; right: 10%; animation-delay: 2s; }
        .shape:nth-child(3) { bottom: 10%; left: 20%; animation-delay: 4s; }
        .shape:nth-child(4) { bottom: 20%; right: 20%; animation-delay: 1s; }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        /* ì‹¤ì‹œê°„ ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .notification.show {
            transform: translateX(0);
        }
        
        /* í¬ì¸íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pointPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .point-animation {
            animation: pointPulse 0.6s ease-in-out;
        }
        
        /* ë­í‚¹ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes rankingSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .ranking-item {
            animation: rankingSlide 0.5s ease-out;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ë‹¤í¬ëª¨ë“œ ì§€ì› */
        .dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .dark-mode .bg-white {
            background-color: #2d2d2d !important;
            color: #ffffff;
        }
        
        /* ë°˜ì‘í˜• ì°¨íŠ¸ */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- ì‹¤ì‹œê°„ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
    <div id="notificationContainer"></div>
    
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loadingScreen" class="fixed inset-0 bg-purple-600 flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold">ğŸŒŸ Minah Teacher's Class</h2>
            <p class="text-purple-200">Firebase ì—°ê²° ì¤‘...</p>
        </div>
    </div>

    <!-- ë©”ì¸ ì„ íƒ í™”ë©´ -->
    <div id="mainSelectionScreen" class="login-container flex items-center justify-center relative hidden">
        <div class="floating-shapes">
            <div class="shape w-20 h-20 bg-white rounded-full"></div>
            <div class="shape w-16 h-16 bg-pink-300 rounded-full"></div>
            <div class="shape w-24 h-24 bg-yellow-300 rounded-full"></div>
            <div class="shape w-12 h-12 bg-blue-300 rounded-full"></div>
        </div>
        
        <div class="bg-white rounded-3xl cute-shadow p-8 max-w-md w-full mx-4 relative z-10">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸŒŸ</div>
                <h1 class="text-3xl font-bold text-purple-600 mb-2">Minah Teacher's</h1>
                <h2 class="text-xl text-gray-600">English Class Points</h2>
                <p class="text-sm text-gray-500 mt-2">ì—­í• ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
            </div>
            
            <div class="space-y-4">
                <button id="teacherLoginBtn" class="w-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                    ğŸ‘©â€ğŸ« êµì‚¬ ë¡œê·¸ì¸
                </button>
                
                <button id="studentAccessBtn" class="w-full bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                    ğŸ‘¨â€ğŸ“ í•™ìƒ ì¡°íšŒ
                </button>
                
                <button id="teacherSetupBtn" class="w-full bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                    âš™ï¸ êµì‚¬ ê³„ì • ì„¤ì •
                </button>
                
                <div class="text-center">
                    <p class="text-xs text-gray-500">
                        ğŸ”’ ì²˜ìŒ ì‚¬ìš©í•˜ì‹œë©´ "êµì‚¬ ê³„ì • ì„¤ì •"ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- êµì‚¬ êµ¬ê¸€ ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="teacherLoginScreen" class="login-container flex items-center justify-center relative hidden">
        <div class="floating-shapes">
            <div class="shape w-20 h-20 bg-white rounded-full"></div>
            <div class="shape w-16 h-16 bg-pink-300 rounded-full"></div>
            <div class="shape w-24 h-24 bg-yellow-300 rounded-full"></div>
            <div class="shape w-12 h-12 bg-blue-300 rounded-full"></div>
        </div>
        
        <div class="bg-white rounded-3xl cute-shadow p-8 max-w-md w-full mx-4 relative z-10">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ‘©â€ğŸ«</div>
                <h1 class="text-2xl font-bold text-purple-600 mb-2">êµì‚¬ ë¡œê·¸ì¸</h1>
                <p class="text-sm text-gray-500 mt-2">êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
            </div>
            
            <div class="space-y-4">
                <button id="googleLoginBtn" class="w-full bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center">
                    <svg class="w-6 h-6 mr-3" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
                </button>
                
                <button id="backToMainBtn" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-xl font-semibold transition-colors">
                    â† ë’¤ë¡œ ê°€ê¸°
                </button>
                
                <div class="text-center">
                    <p class="text-xs text-gray-500">
                        ğŸ”’ ì¸ì¦ëœ êµì‚¬ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- êµì‚¬ ê³„ì • ì„¤ì • í™”ë©´ -->
    <div id="teacherSetupScreen" class="login-container flex items-center justify-center relative hidden">
        <div class="bg-white rounded-3xl cute-shadow p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">âš™ï¸</div>
                <h2 class="text-2xl font-bold text-orange-600 mb-2">êµì‚¬ ê³„ì • ì„¤ì •</h2>
                <p class="text-sm text-gray-500">ì²˜ìŒ ì‚¬ìš©í•˜ì‹œëŠ” ê²½ìš° ê³„ì •ì„ ì„¤ì •í•´ì£¼ì„¸ìš”</p>
            </div>
            
            <div class="space-y-4">
                <button id="setupGoogleLoginBtn" class="w-full bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center">
                    <svg class="w-6 h-6 mr-3" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ê°€ì…í•˜ê¸°
                </button>
                
                <button id="backToMainFromSetupBtn" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-xl font-semibold transition-colors">
                    â† ë’¤ë¡œ ê°€ê¸°
                </button>
                
                <div class="text-center">
                    <p class="text-xs text-gray-500">
                        ğŸ” ê°€ì… í›„ ê´€ë¦¬ìë¡œë¶€í„° ë°›ì€ ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- êµì‚¬ ì¸ì¦ ì½”ë“œ ì…ë ¥ í™”ë©´ -->
    <div id="teacherVerificationScreen" class="login-container flex items-center justify-center relative hidden">
        <div class="bg-white rounded-3xl cute-shadow p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ”</div>
                <h2 class="text-2xl font-bold text-purple-600 mb-2">êµì‚¬ ì¸ì¦</h2>
                <p id="verificationUserEmail" class="text-gray-600 mb-4"></p>
                <p class="text-sm text-gray-500">ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            </div>
            
            <div class="space-y-4">
                <input type="text" id="verificationCode" placeholder="ì¸ì¦ ì½”ë“œ ì…ë ¥" 
                       class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none text-center text-lg font-bold tracking-widest">
                <div class="flex space-x-3">
                    <button id="verifyCodeBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                        âœ… ì¸ì¦í•˜ê¸°
                    </button>
                    <button id="cancelVerificationBtn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-xl font-semibold transition-colors">
                        ì·¨ì†Œ
                    </button>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-500">
                        ğŸ” ê´€ë¦¬ìë¡œë¶€í„° ë°›ì€ ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”
                    </p>
                </div>
            </div>
        </div>
    </div>



    <!-- í•™ìƒ ì •ë³´ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="studentInfoModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 cute-shadow max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold text-green-600 mb-6 text-center">ğŸ‘¨â€ğŸ“ í•™ìƒ ì •ë³´ ì…ë ¥</h2>
            <div class="space-y-4">
                <select id="studentYearSelect" class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:border-green-400 focus:outline-none">
                    <option value="">í•™ë…„ë„ ì„ íƒ</option>
                </select>
                <select id="studentSubjectSelect" class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:border-green-400 focus:outline-none">
                    <option value="">ìˆ˜ì—… ì„ íƒ</option>
                </select>
                <select id="studentClassSelect" class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:border-green-400 focus:outline-none">
                    <option value="">ë°˜ ì„ íƒ</option>
                    <option value="1ë°˜">1ë°˜</option>
                    <option value="2ë°˜">2ë°˜</option>
                    <option value="3ë°˜">3ë°˜</option>
                    <option value="4ë°˜">4ë°˜</option>
                    <option value="5ë°˜">5ë°˜</option>
                    <option value="6ë°˜">6ë°˜</option>
                    <option value="7ë°˜">7ë°˜</option>
                    <option value="8ë°˜">8ë°˜</option>
                    <option value="9ë°˜">9ë°˜</option>
                    <option value="10ë°˜">10ë°˜</option>
                </select>
                <input type="number" id="studentNumber" placeholder="í•™ë²ˆ ì…ë ¥" min="1" max="50"
                       class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:border-green-400 focus:outline-none">
                <input type="text" id="studentName" placeholder="ì´ë¦„ ì…ë ¥"
                       class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:border-green-400 focus:outline-none">
                <div class="flex space-x-3">
                    <button id="studentInfoSubmit" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                        ì…ì¥í•˜ê¸°
                    </button>
                    <button id="studentInfoCancel" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-xl font-semibold transition-colors">
                        ì·¨ì†Œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div id="mainApp" class="hidden">
        <!-- í—¤ë” -->
        <div class="bg-white cute-shadow mb-8 sticky top-0 z-40">
            <div class="container mx-auto px-4 md:px-6 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-lg md:text-4xl font-black text-indigo-700 ml-12 md:ml-0" style="font-family: 'Nunito', sans-serif; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">ğŸŒŸ Minah Teacher's Class Points</h1>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <!-- ì‹¤ì‹œê°„ ì ‘ì†ì í‘œì‹œ -->
                        <div id="onlineUsers" class="hidden md:flex items-center space-x-2 bg-green-100 px-3 py-1 rounded-full">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-green-700 text-sm font-semibold">ì˜¨ë¼ì¸: <span id="onlineCount">1</span>ëª…</span>
                        </div>
                        
                        <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ -->
                        <button id="darkModeToggle" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full transition-colors">
                            <span class="text-lg">ğŸŒ™</span>
                        </button>
                        
                        <span id="userInfo" class="text-sm md:text-base text-purple-600 font-semibold"></span>
                        <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 md:px-6 py-2 rounded-full font-semibold transition-colors text-xs md:text-base">
                            ğŸšª ë¡œê·¸ì•„ì›ƒ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ -->
        <button id="mobileMenuToggle" class="md:hidden fixed top-4 left-4 z-50 bg-purple-500 text-white p-3 rounded-full shadow-lg">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>

        <div class="flex">
            <!-- ì‚¬ì´ë“œë°” (ì„ ìƒë‹˜ìš©) -->
            <div id="sidebar" class="w-56 md:w-56 bg-gradient-to-b from-purple-100 via-indigo-100 to-violet-100 h-screen fixed left-0 top-0 pt-24 px-4 shadow-2xl transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40">
                <div class="space-y-3">
                    <div class="text-sm md:text-lg font-bold text-indigo-700 mb-3 px-3">ğŸ“… í•™ë…„ë„ ì„ íƒ</div>
                    <select id="yearSelect" class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-white rounded-xl focus:border-yellow-300 focus:outline-none text-xs md:text-sm mb-4 bg-white text-purple-700 font-semibold">
                        <option value="">í•™ë…„ë„ ì„ íƒ</option>
                    </select>
                    
                    <div class="text-sm md:text-lg font-bold text-indigo-700 mb-3 px-3">ğŸ“– ìˆ˜ì—… ì„ íƒ</div>
                    <select id="subjectSelect" class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-white rounded-xl focus:border-yellow-300 focus:outline-none text-xs md:text-sm mb-4 bg-white text-purple-700 font-semibold">
                        <option value="">ìˆ˜ì—… ì„ íƒ</option>
                    </select>
                    
                    <div class="text-sm md:text-lg font-bold text-indigo-700 mb-3 px-3">ğŸ“š ë°˜ ì„ íƒ</div>
                    <select id="classSelect" class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-white rounded-xl focus:border-yellow-300 focus:outline-none text-xs md:text-sm mb-5 bg-white text-purple-700 font-semibold">
                        <option value="">ë°˜ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="1ë°˜">1ë°˜</option>
                        <option value="2ë°˜">2ë°˜</option>
                        <option value="3ë°˜">3ë°˜</option>
                        <option value="4ë°˜">4ë°˜</option>
                        <option value="5ë°˜">5ë°˜</option>
                        <option value="6ë°˜">6ë°˜</option>
                        <option value="7ë°˜">7ë°˜</option>
                        <option value="8ë°˜">8ë°˜</option>
                        <option value="9ë°˜">9ë°˜</option>
                        <option value="10ë°˜">10ë°˜</option>
                    </select>
                    
                    <div class="border-t-2 border-gray-400 border-opacity-30 my-5"></div>
                    
                    <div class="text-sm md:text-lg font-bold text-indigo-700 mb-4 px-3">ğŸ“‹ ë©”ë‰´</div>
                    <button id="menuPoints" class="menu-item w-full text-left px-3 md:px-4 py-2 md:py-3 rounded-xl font-bold text-indigo-700 bg-white bg-opacity-50 hover:bg-indigo-50 hover:bg-opacity-80 hover:shadow-lg transition-all duration-300 text-sm md:text-lg">
                        âœ¨ í¬ì¸íŠ¸ ê´€ë¦¬
                    </button>
                    <button id="menuDashboard" class="menu-item w-full text-left px-3 md:px-4 py-2 md:py-3 rounded-xl font-bold text-indigo-700 bg-white bg-opacity-50 hover:bg-indigo-50 hover:bg-opacity-80 hover:shadow-lg transition-all duration-300 text-sm md:text-lg">
                        ğŸ“Š ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ
                    </button>
                    <button id="menuDetails" class="menu-item w-full text-left px-3 md:px-4 py-2 md:py-3 rounded-xl font-bold text-indigo-700 bg-white bg-opacity-50 hover:bg-indigo-50 hover:bg-opacity-80 hover:shadow-lg transition-all duration-300 text-sm md:text-lg">
                        ğŸ“ˆ ê°œë³„ ë¶„ì„
                    </button>
                    <button id="menuRewards" class="menu-item w-full text-left px-3 md:px-4 py-2 md:py-3 rounded-xl font-bold text-indigo-700 bg-white bg-opacity-50 hover:bg-indigo-50 hover:bg-opacity-80 hover:shadow-lg transition-all duration-300 text-sm md:text-lg">
                        ğŸ ë³´ìƒ ê´€ë¦¬
                    </button>
                    <button id="menuStudents" class="menu-item w-full text-left px-3 md:px-4 py-2 md:py-3 rounded-xl font-bold text-indigo-700 bg-white bg-opacity-50 hover:bg-indigo-50 hover:bg-opacity-80 hover:shadow-lg transition-all duration-300 text-sm md:text-lg">
                        ğŸ‘¥ í•™ìƒ ê´€ë¦¬
                    </button>
                    <button id="menuSettings" class="menu-item w-full text-left px-3 md:px-4 py-2 md:py-3 rounded-xl font-bold text-indigo-700 bg-white bg-opacity-50 hover:bg-indigo-50 hover:bg-opacity-80 hover:shadow-lg transition-all duration-300 text-sm md:text-lg">
                        âš™ï¸ ì„¤ì •
                    </button>
                </div>
            </div>

            <!-- ì˜¤ë²„ë ˆì´ (ëª¨ë°”ì¼ìš©) -->
            <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>

            <!-- ë©”ì¸ ì½˜í…ì¸  -->
            <div id="mainContent" class="flex-1 px-4 md:px-8 pr-4 md:pr-12">
                <!-- í™˜ì˜ ë©”ì‹œì§€ -->
                <div id="welcomeMessage" class="text-center py-16">
                    <div class="bg-white rounded-2xl cute-shadow p-8 max-w-md mx-auto">
                        <div class="text-6xl mb-4">ğŸŒŸ</div>
                        <h2 class="text-2xl font-bold text-purple-600 mb-4">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                        <p id="welcomeText" class="text-gray-600 mb-6"></p>
                        <div id="quickStats" class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-blue-50 rounded-lg p-3">
                                <div class="text-2xl font-bold text-blue-600" id="totalStudentsCount">0</div>
                                <div class="text-sm text-blue-500">ì´ í•™ìƒ ìˆ˜</div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-2xl font-bold text-green-600" id="totalPointsCount">0</div>
                                <div class="text-sm text-green-500">ì´ í¬ì¸íŠ¸</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í•™ìƒ ë·° ì„¹ì…˜ -->
                <div id="studentViewSection" class="hidden">
                    <div id="studentPointDisplay" class="bg-white rounded-2xl cute-shadow p-8 text-center">
                        <h2 class="text-3xl font-bold text-green-600 mb-6">ğŸ‘¨â€ğŸ“ ë‚´ í¬ì¸íŠ¸ í˜„í™©</h2>
                        <div id="studentInfo"></div>
                        
                        <!-- í•™ìƒìš© ì‹¤ì‹œê°„ ë­í‚¹ -->
                        <div class="mt-8 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-orange-600 mb-4">ğŸ† ì‹¤ì‹œê°„ ë°˜ ë­í‚¹</h3>
                            <div id="studentRanking"></div>
                        </div>
                        
                        <!-- ê°œì¸ ëª©í‘œ ì„¤ì • -->
                        <div class="mt-8 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-purple-600 mb-4">ğŸ¯ ë‚˜ì˜ ëª©í‘œ</h3>
                            <div id="personalGoals"></div>
                        </div>
                    </div>
                </div>

                <!-- ì„ ìƒë‹˜ ì„¹ì…˜ë“¤ -->
                <div id="teacherSections">
                    <!-- í¬ì¸íŠ¸ ê´€ë¦¬ -->
                    <div id="pointsSection" class="space-y-8 hidden">
                        <div id="teacherControls" class="bg-white rounded-2xl cute-shadow p-6">
                            <h2 class="text-2xl font-bold text-purple-600 mb-4">âœ¨ í¬ì¸íŠ¸ ê´€ë¦¬</h2>
                            
                            <!-- ì„ íƒ ëª¨ë“œ í† ê¸€ -->
                            <div class="mb-4">
                                <div class="flex space-x-4">
                                    <label class="flex items-center">
                                        <input type="radio" name="selectionMode" value="single" checked class="mr-2">
                                        <span class="font-semibold">ê°œë³„ ì„ íƒ</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="selectionMode" value="multiple" class="mr-2">
                                        <span class="font-semibold">ë‹¤ì¤‘ ì„ íƒ</span>
                                    </label>
                                </div>
                            </div>

                            <!-- ê°œë³„ ì„ íƒ ëª¨ë“œ -->
                            <div id="singleMode" class="grid md:grid-cols-2 gap-4 mb-4">
                                <select id="studentSelect" class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                    <option value="">í•™ìƒ ì„ íƒ</option>
                                </select>
                                <input type="number" id="pointValue" placeholder="í¬ì¸íŠ¸" min="1" max="10"
                                       class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            </div>

                            <!-- ë‹¤ì¤‘ ì„ íƒ ëª¨ë“œ -->
                            <div id="multipleMode" class="hidden mb-4">
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center">
                                            <label class="font-semibold text-purple-600">í•™ìƒ ì„ íƒ (ë‹¤ì¤‘)</label>
                                            <div class="space-x-2">
                                                <button type="button" id="selectAllStudents" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">ì „ì²´ì„ íƒ</button>
                                                <button type="button" id="clearAllStudents" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">ì „ì²´í•´ì œ</button>
                                            </div>
                                        </div>
                                        <input type="text" id="studentSearchInput" placeholder="ğŸ” ì´ë¦„ ë˜ëŠ” ë²ˆí˜¸ë¡œ ê²€ìƒ‰..." 
                                               class="w-full px-3 py-2 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none text-sm">
                                        <div id="studentCheckboxList" class="max-h-40 overflow-y-auto border-2 border-purple-200 rounded-xl p-3 bg-gray-50">
                                        </div>
                                    </div>
                                    <input type="number" id="pointValueMultiple" placeholder="í¬ì¸íŠ¸" min="1" max="10"
                                           class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-4 mb-4">
                                <select id="pointCategory" class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                    <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                                    <option value="ë°œí‘œ">ğŸ“¢ ë°œí‘œ</option>
                                    <option value="ê³¼ì œ">ğŸ“ ê³¼ì œ</option>
                                    <option value="ì°¸ì—¬">ğŸ™‹â€â™‚ï¸ ìˆ˜ì—… ì°¸ì—¬</option>
                                    <option value="í˜‘ë ¥">ğŸ¤ íŒ€ì›Œí¬</option>
                                    <option value="ì°½ì˜">ğŸ’¡ ì°½ì˜ì„±</option>
                                    <option value="ê¸°íƒ€">â­ ê¸°íƒ€</option>
                                </select>
                                <input type="text" id="pointDescription" placeholder="ê°„ë‹¨í•œ ì„¤ëª… (ì„ íƒì‚¬í•­)" 
                                       class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            </div>
                            
                            <!-- ë¹ ë¥¸ í¬ì¸íŠ¸ ë²„íŠ¼ -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-purple-600 mb-2">ë¹ ë¥¸ í¬ì¸íŠ¸ ì¶”ê°€</label>
                                <div class="flex space-x-2">
                                    <button type="button" class="quick-point-btn bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg font-semibold" data-points="1">+1ì </button>
                                    <button type="button" class="quick-point-btn bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg font-semibold" data-points="2">+2ì </button>
                                    <button type="button" class="quick-point-btn bg-purple-100 hover:bg-purple-200 text-purple-700 px-4 py-2 rounded-lg font-semibold" data-points="3">+3ì </button>
                                    <button type="button" class="quick-point-btn bg-orange-100 hover:bg-orange-200 text-orange-700 px-4 py-2 rounded-lg font-semibold" data-points="5">+5ì </button>
                                </div>
                            </div>
                            
                            <button id="addPointBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ğŸ‰ í¬ì¸íŠ¸ ì¶”ê°€
                            </button>
                        </div>

                        <!-- í¬ì¸íŠ¸ ì¶”ê°€ ê²°ê³¼ -->
                        <div id="pointAdditionResult" class="bg-white rounded-2xl cute-shadow p-6 hidden">
                            <h2 class="text-2xl font-bold text-green-600 mb-4">âœ… í¬ì¸íŠ¸ ì¶”ê°€ ì™„ë£Œ</h2>
                            <div id="updatedStudentsDisplay" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4"></div>
                        </div>
                    </div>

                    <!-- ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ -->
                    <div id="dashboardSection" class="hidden space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <!-- ì‹¤ì‹œê°„ í†µê³„ ì¹´ë“œë“¤ -->
                            <div class="bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-2xl p-6 cute-shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100">ì´ í•™ìƒ ìˆ˜</p>
                                        <p class="text-3xl font-bold" id="dashTotalStudents">0</p>
                                    </div>
                                    <div class="text-4xl">ğŸ‘¥</div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-400 to-green-600 text-white rounded-2xl p-6 cute-shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100">ì´ í¬ì¸íŠ¸</p>
                                        <p class="text-3xl font-bold" id="dashTotalPoints">0</p>
                                    </div>
                                    <div class="text-4xl">â­</div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-purple-400 to-purple-600 text-white rounded-2xl p-6 cute-shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-purple-100">í‰ê·  í¬ì¸íŠ¸</p>
                                        <p class="text-3xl font-bold" id="dashAvgPoints">0</p>
                                    </div>
                                    <div class="text-4xl">ğŸ“Š</div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-orange-400 to-orange-600 text-white rounded-2xl p-6 cute-shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-orange-100">ì˜¤ëŠ˜ í™œë™</p>
                                        <p class="text-3xl font-bold" id="dashTodayActivity">0</p>
                                    </div>
                                    <div class="text-4xl">ğŸ”¥</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì‹¤ì‹œê°„ ì°¨íŠ¸ -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white rounded-2xl cute-shadow p-6">
                                <h3 class="text-xl font-bold text-purple-600 mb-4">ğŸ“ˆ í¬ì¸íŠ¸ ì¶”ì´</h3>
                                <div class="chart-container">
                                    <canvas id="pointTrendChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-2xl cute-shadow p-6">
                                <h3 class="text-xl font-bold text-purple-600 mb-4">ğŸ† TOP 10 ë­í‚¹</h3>
                                <div id="realTimeRanking"></div>
                            </div>
                        </div>
                        
                        <!-- ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„ -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <h3 class="text-xl font-bold text-purple-600 mb-4">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                <div class="text-center p-4 bg-red-50 rounded-xl">
                                    <div class="text-2xl mb-2">ğŸ“¢</div>
                                    <div class="text-sm text-gray-600">ë°œí‘œ</div>
                                    <div class="text-xl font-bold text-red-600" id="categoryPresentation">0</div>
                                </div>
                                <div class="text-center p-4 bg-blue-50 rounded-xl">
                                    <div class="text-2xl mb-2">ğŸ“</div>
                                    <div class="text-sm text-gray-600">ê³¼ì œ</div>
                                    <div class="text-xl font-bold text-blue-600" id="categoryHomework">0</div>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-xl">
                                    <div class="text-2xl mb-2">ğŸ™‹â€â™‚ï¸</div>
                                    <div class="text-sm text-gray-600">ì°¸ì—¬</div>
                                    <div class="text-xl font-bold text-green-600" id="categoryParticipation">0</div>
                                </div>
                                <div class="text-center p-4 bg-yellow-50 rounded-xl">
                                    <div class="text-2xl mb-2">ğŸ¤</div>
                                    <div class="text-sm text-gray-600">í˜‘ë ¥</div>
                                    <div class="text-xl font-bold text-yellow-600" id="categoryTeamwork">0</div>
                                </div>
                                <div class="text-center p-4 bg-purple-50 rounded-xl">
                                    <div class="text-2xl mb-2">ğŸ’¡</div>
                                    <div class="text-sm text-gray-600">ì°½ì˜</div>
                                    <div class="text-xl font-bold text-purple-600" id="categoryCreativity">0</div>
                                </div>
                                <div class="text-center p-4 bg-gray-50 rounded-xl">
                                    <div class="text-2xl mb-2">â­</div>
                                    <div class="text-sm text-gray-600">ê¸°íƒ€</div>
                                    <div class="text-xl font-bold text-gray-600" id="categoryOther">0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê°œë³„ ë¶„ì„ -->
                    <div id="detailsSection" class="hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-purple-600">ğŸ“ˆ ê°œë³„ í•™ìƒ ë¶„ì„</h2>
                            <div class="space-x-2">
                                <button id="exportAnalysisBtn" class="bg-gradient-to-r from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 text-white px-6 py-3 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                                    ğŸ“Š ë¶„ì„ ë¦¬í¬íŠ¸ ë‚´ë³´ë‚´ê¸°
                                </button>
                                <button id="showStatsBtn" class="bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white px-6 py-3 rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                                    ğŸ“ˆ ì‹¤ì‹œê°„ í†µê³„ ë³´ê¸°
                                </button>
                            </div>
                        </div>
                        
                        <!-- í†µê³„ íŒ¨ë„ -->
                        <div id="statisticsPanel" class="hidden bg-white rounded-2xl cute-shadow p-6 mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold text-orange-600">ğŸ† ì‹¤ì‹œê°„ ë­í‚¹ & í†µê³„</h3>
                                <button id="hideStatsBtn" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                                    âœ• ë‹«ê¸°
                                </button>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div id="topStudentsRanking"></div>
                                <div id="classStatistics"></div>
                            </div>
                        </div>
                        
                        <div id="studentDetails" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </div>

                    <!-- ë³´ìƒ ê´€ë¦¬ -->
                    <div id="rewardsSection" class="hidden">
                        <h2 class="text-2xl font-bold text-purple-600 mb-6">ğŸ ë³´ìƒ ê´€ë¦¬</h2>
                        
                        <!-- ë³´ìƒ ì„¤ì • -->
                        <div class="bg-white rounded-2xl cute-shadow p-6 mb-6">
                            <h3 class="text-xl font-bold text-purple-600 mb-4">âš™ï¸ ë³´ìƒ ì„¤ì •</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-purple-600 mb-2">ë³´ìƒ ê°„ê²© (ì ìˆ˜)</label>
                                    <input type="number" id="rewardInterval" placeholder="10" min="1" max="50" value="10"
                                           class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-purple-600 mb-2">ìµœëŒ€ ë³´ìƒ ì ìˆ˜</label>
                                    <input type="number" id="maxRewardPoints" placeholder="100" min="10" max="500" value="100"
                                           class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                </div>
                                <div class="flex items-end">
                                    <button id="saveRewardSettingsBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                        ğŸ’¾ ì„¤ì • ì €ì¥
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="rewardsDisplay" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </div>

                    <!-- í•™ìƒ ê´€ë¦¬ -->
                    <div id="studentsSection" class="hidden space-y-8">
                        <!-- ì—‘ì…€ ì—…ë¡œë“œ -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <h2 class="text-2xl font-bold text-purple-600 mb-4">ğŸ“Š í•™ìƒ ëª…ë‹¨ ì—…ë¡œë“œ</h2>
                            <div class="mb-4">
                                <p class="text-sm text-gray-600 mb-2">ì—‘ì…€ íŒŒì¼ í˜•ì‹: ì—°ë²ˆ(Aì—´), ì´ë¦„(Bì—´)</p>
                                <input type="file" id="excelFile" accept=".xlsx,.xls" 
                                       class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            </div>
                            <button id="uploadBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ğŸ“¤ ëª…ë‹¨ ì—…ë¡œë“œ
                            </button>
                        </div>

                        <!-- ìˆ˜ë™ í•™ìƒ ê´€ë¦¬ -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <h2 class="text-2xl font-bold text-purple-600 mb-4">ğŸ‘¤ í•™ìƒ ê°œë³„ ê´€ë¦¬</h2>
                            <div class="grid md:grid-cols-3 gap-4 mb-4">
                                <input type="number" id="newStudentNumber" placeholder="ë²ˆí˜¸" 
                                       class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                <input type="text" id="newStudentName" placeholder="ì´ë¦„" 
                                       class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                <button id="addStudentBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                    â• í•™ìƒ ì¶”ê°€
                                </button>
                            </div>
                        </div>

                        <!-- í•™ìƒ ëª©ë¡ ê´€ë¦¬ -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-2xl font-bold text-purple-600">ğŸ“‹ í˜„ì¬ í•™ìƒ ëª©ë¡</h2>
                                <div class="space-x-2">
                                    <button id="selectAllBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold transition-colors">
                                        âœ… ì „ì²´ ì„ íƒ
                                    </button>
                                    <button id="deleteSelectedBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full text-sm font-semibold transition-colors">
                                        ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ
                                    </button>
                                </div>
                            </div>
                            <div id="studentManagementList"></div>
                        </div>
                    </div>

                    <!-- ì„¤ì • -->
                    <div id="settingsSection" class="hidden space-y-8">
                        <!-- Firebase ì—°ê²° ìƒíƒœ -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <h2 class="text-2xl font-bold text-green-600 mb-4">ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ</h2>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-green-50 rounded-xl p-4">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                        <span class="font-semibold text-green-700">ì‹¤ì‹œê°„ ë™ê¸°í™” í™œì„±</span>
                                    </div>
                                    <p class="text-sm text-green-600">ëª¨ë“  ë°ì´í„°ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤</p>
                                </div>
                                <div class="bg-blue-50 rounded-xl p-4">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                        <span class="font-semibold text-blue-700">êµ¬ê¸€ ê³„ì • ì—°ë™</span>
                                    </div>
                                    <p class="text-sm text-blue-600">ì•ˆì „í•œ êµ¬ê¸€ ì¸ì¦ìœ¼ë¡œ ë³´í˜¸ë©ë‹ˆë‹¤</p>
                                </div>
                            </div>
                        </div>

                        <!-- ë°ì´í„° ê´€ë¦¬ -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <h2 class="text-2xl font-bold text-orange-600 mb-4">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h2>
                            
                            <!-- ì €ì¥ ê³µê°„ ì‚¬ìš©ëŸ‰ -->
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4">
                                <h3 class="text-lg font-bold text-purple-600 mb-3">ğŸ“Š ë°ì´í„° í˜„í™©</h3>
                                <div id="storageInfo" class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">ì´ í•™ìƒ ìˆ˜:</span>
                                        <span id="totalStudents" class="font-bold text-blue-600">0ëª…</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">ì´ í¬ì¸íŠ¸ ê¸°ë¡:</span>
                                        <span id="totalPointRecords" class="font-bold text-green-600">0ê°œ</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span>
                                        <span id="lastUpdate" class="font-bold text-purple-600">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ë°±ì—… ì˜µì…˜ -->
                            <div class="space-y-4">
                                <div class="bg-green-50 rounded-xl p-4">
                                    <h4 class="text-lg font-bold text-green-600 mb-3">ğŸ“Š ì—‘ì…€ ë°±ì—…</h4>
                                    <div class="grid md:grid-cols-2 gap-3">
                                        <button id="backupExcelAllBtn" class="bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                            ğŸ“Š ì „ì²´ ë°ì´í„° ë°±ì—…
                                        </button>
                                        <button id="backupExcelCurrentBtn" class="bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-semibold transition-colors">
                                            ğŸ“‹ í˜„ì¬ ë°˜ë§Œ ë°±ì—…
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- í•™ë…„ë„ ë° ìˆ˜ì—… ì„¤ì • -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <h2 class="text-2xl font-bold text-purple-600 mb-4">âš™ï¸ í•™ë…„ë„ ë° ìˆ˜ì—… ì„¤ì •</h2>
                            <div class="grid md:grid-cols-2 gap-4 mb-4">
                                <input type="text" id="newYear" placeholder="í•™ë…„ë„ (ì˜ˆ: 2024)" 
                                       class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                <input type="text" id="newSubject" placeholder="ìˆ˜ì—…ëª… (ì˜ˆ: ì˜ì–´)" 
                                       class="px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            </div>
                            <button id="saveYearSubjectBtn" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ğŸ’¾ í•™ë…„ë„/ìˆ˜ì—… ì €ì¥
                            </button>
                        </div>

                        <!-- ì €ì¥ëœ í•™ë…„ë„ ë° ìˆ˜ì—… -->
                        <div class="bg-white rounded-2xl cute-shadow p-6">
                            <h2 class="text-2xl font-bold text-purple-600 mb-4">ğŸ“š ì €ì¥ëœ í•™ë…„ë„ ë° ìˆ˜ì—…</h2>
                            <div id="savedYearSubjects"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let isTeacher = false;
        let isStudent = false;
        let currentStudent = null;
        let currentYear = '';
        let currentSubject = '';
        let currentClass = '';
        let currentView = 'points';
        let rewardSettings = { interval: 10, maxPoints: 100 };
        let unsubscribeListeners = [];
        let isDarkMode = false;

        // ë‹¤ì–‘í•œ ì•„ë°”íƒ€ SVG
        const avatars = [
            `<svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="#FFB6C1"/>
                <circle cx="35" cy="35" r="4" fill="#FF1493"/>
                <circle cx="65" cy="35" r="4" fill="#FF1493"/>
                <path d="M 30 60 Q 50 75 70 60" stroke="#FF1493" stroke-width="3" fill="none"/>
                <circle cx="25" cy="25" r="6" fill="#FF69B4"/>
                <circle cx="75" cy="25" r="6" fill="#FF69B4"/>
            </svg>`,
            `<svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="#87CEEB"/>
                <circle cx="35" cy="38" r="3" fill="#4169E1"/>
                <circle cx="65" cy="38" r="3" fill="#4169E1"/>
                <path d="M 40 58 Q 50 65 60 58" stroke="#4169E1" stroke-width="2" fill="none"/>
                <rect x="35" y="20" width="30" height="8" rx="4" fill="#4169E1"/>
            </svg>`,
            `<svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="#98FB98"/>
                <circle cx="35" cy="40" r="4" fill="#228B22"/>
                <circle cx="65" cy="40" r="4" fill="#228B22"/>
                <ellipse cx="50" cy="60" rx="12" ry="8" fill="#228B22"/>
                <polygon points="40,15 50,5 60,15 50,25" fill="#32CD32"/>
            </svg>`,
            `<svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="#FFFF99"/>
                <circle cx="35" cy="38" r="3" fill="#FF8C00"/>
                <circle cx="65" cy="38" r="3" fill="#FF8C00"/>
                <path d="M 35 62 Q 50 72 65 62" stroke="#FF8C00" stroke-width="3" fill="none"/>
                <polygon points="45,20 50,10 55,20 50,30" fill="#FFD700"/>
            </svg>`,
            `<svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="#DDA0DD"/>
                <circle cx="35" cy="40" r="4" fill="#8A2BE2"/>
                <circle cx="65" cy="40" r="4" fill="#8A2BE2"/>
                <path d="M 40 60 Q 50 68 60 60" stroke="#8A2BE2" stroke-width="2" fill="none"/>
                <ellipse cx="35" cy="25" rx="8" ry="12" fill="#9370DB"/>
                <ellipse cx="65" cy="25" rx="8" ry="12" fill="#9370DB"/>
            </svg>`
        ];

        // Firebase ì¸ì¦ ìƒíƒœ ë³€í™” ê°ì§€ ë° ì•± ì‹œì‘
        function startApp() {
            document.getElementById('loadingScreen').classList.add('hidden');
            
            // Firebase ìƒíƒœ í™•ì¸
            if (window.firebaseInitialized && window.onAuthStateChanged && window.auth) {
                console.log('ğŸ”¥ Firebase ëª¨ë“œë¡œ ì‹œì‘');
                
                // Firebase ì¸ì¦ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                try {
                    window.onAuthStateChanged(window.auth, (user) => {
                        if (user) {
                            currentUser = user;
                            checkTeacherVerification(user);
                        } else {
                            currentUser = null;
                            showMainSelection();
                        }
                    });
                    
                    // Firebase ìƒíƒœì— ë”°ë¥¸ ì•Œë¦¼
                    if (window.firebaseCanWrite) {
                        showNotification('ğŸ”¥ Firebase ì™„ì „ ì—°ê²°! ì‹¤ì‹œê°„ ë™ê¸°í™” í™œì„±í™”', 'success');
                    } else {
                        showNotification('âš ï¸ Firebase ë¶€ë¶„ ì—°ê²° (ì½ê¸° ì „ìš©)', 'warning');
                        
                        // ê¶Œí•œ ì„¤ì • ì•ˆë‚´ (3ì´ˆ í›„)
                        setTimeout(() => {
                            if (window.firebaseError && 
                                (window.firebaseError.code === 'permission-denied' || 
                                 window.firebaseError.message?.includes('Missing or insufficient permissions'))) {
                                showFirebasePermissionError();
                            }
                        }, 3000);
                    }
                } catch (error) {
                    console.error('Firebase ì¸ì¦ ì„¤ì • ì˜¤ë¥˜:', error);
                    handleFirebaseError(error);
                }
            } else {
                // Firebase ì—°ê²° ì‹¤íŒ¨ ì²˜ë¦¬
                console.log('âš ï¸ Firebase ì—°ê²° ì‹¤íŒ¨ - ì„¤ì • í™•ì¸ í•„ìš”');
                
                if (window.firebaseError) {
                    console.error('Firebase ì˜¤ë¥˜ ìƒì„¸:', window.firebaseError);
                    
                    // íŠ¹ì • ì˜¤ë¥˜ì— ë”°ë¥¸ ì²˜ë¦¬
                    if (window.firebaseError.code === 'permission-denied' || 
                        window.firebaseError.message?.includes('Missing or insufficient permissions')) {
                        showFirebasePermissionError();
                    } else {
                        showFirebaseConnectionError();
                    }
                } else {
                    showFirebaseConnectionError();
                }
            }
        }
        
        // Firebase ê¶Œí•œ ì˜¤ë¥˜ ì²˜ë¦¬ (ê°œì„ ë¨)
        function showFirebasePermissionError() {
            showMainSelection();
            
            setTimeout(() => {
                const errorModal = document.createElement('div');
                errorModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                errorModal.innerHTML = `
                    <div class="bg-white rounded-2xl p-6 max-w-lg mx-4 shadow-2xl">
                        <div class="text-center mb-6">
                            <div class="text-4xl mb-3">ğŸ”’</div>
                            <h2 class="text-xl font-bold text-orange-600 mb-2">Firebase ê¶Œí•œ ì„¤ì • í•„ìš”</h2>
                            <p class="text-gray-600 text-sm">ì‹¤ì‹œê°„ ë™ê¸°í™”ë¥¼ ìœ„í•´ Firestore ê·œì¹™ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-4">
                            <p class="text-yellow-800 text-sm"><strong>í˜„ì¬ ìƒíƒœ:</strong> Firebase ì—°ê²°ë¨ (ì½ê¸° ì „ìš©)</p>
                            <p class="text-yellow-700 text-sm mt-1">ì“°ê¸° ê¶Œí•œ ì„¤ì • í›„ ì™„ì „í•œ ì‹¤ì‹œê°„ ë™ê¸°í™” ê°€ëŠ¥</p>
                        </div>
                        
                        <div class="space-y-3">
                            <button onclick="this.closest('.fixed').remove(); showFirebaseSetupGuide();" 
                                    class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ğŸ”§ Firebase ê·œì¹™ ì„¤ì •í•˜ê¸° (5ë¶„)
                            </button>
                            <button onclick="this.closest('.fixed').remove(); continueWithReadOnlyMode();" 
                                    class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                                ğŸ‘€ ì½ê¸° ì „ìš©ìœ¼ë¡œ ê³„ì†
                            </button>
                            <button onclick="this.closest('.fixed').remove();" 
                                    class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-xl font-semibold transition-colors">
                                âœ• ë‹«ê¸°
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(errorModal);
            }, 1000);
        }
        
        // Firebase ì—°ê²° ì˜¤ë¥˜ ì²˜ë¦¬
        function showFirebaseConnectionError() {
            showMainSelection();
            
            setTimeout(() => {
                const errorModal = document.createElement('div');
                errorModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                errorModal.innerHTML = `
                    <div class="bg-white rounded-2xl p-6 max-w-lg mx-4 shadow-2xl">
                        <div class="text-center mb-6">
                            <div class="text-4xl mb-3">âš ï¸</div>
                            <h2 class="text-xl font-bold text-orange-600 mb-2">Firebase ì—°ê²° í™•ì¸ í•„ìš”</h2>
                            <p class="text-gray-600 text-sm">ì‹¤ì‹œê°„ ë™ê¸°í™”ë¥¼ ìœ„í•´ Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”</p>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <p class="text-yellow-700 text-sm"><strong>ìƒí™©:</strong> Firebase ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                        
                        <div class="space-y-3">
                            <button onclick="this.closest('.fixed').remove(); showFirebaseSetupGuide();" 
                                    class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold">
                                ğŸ”§ Firebase ì„¤ì • í™•ì¸í•˜ê¸°
                            </button>
                            <button onclick="this.closest('.fixed').remove(); location.reload();" 
                                    class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold">
                                ğŸ”„ ë‹¤ì‹œ ì‹œë„
                            </button>
                            <button onclick="this.closest('.fixed').remove();" 
                                    class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-xl font-semibold">
                                âœ• ë‹«ê¸°
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(errorModal);
            }, 1000);
        }
        
        // Firebase ì˜¤ë¥˜ ì²˜ë¦¬ í•¨ìˆ˜
        function handleFirebaseError(error) {
            console.error('Firebase ì˜¤ë¥˜:', error);
            
            if (error.code === 'permission-denied') {
                showFirebasePermissionError();
            } else {
                showFirebaseConnectionError();
            }
        }

        // Firebase ì¤€ë¹„ ì™„ë£Œ ëŒ€ê¸°
        function waitForFirebaseAndStart() {
            if (typeof window.firebaseInitialized !== 'undefined') {
                startApp();
            } else {
                // Firebase ì´ˆê¸°í™” ì´ë²¤íŠ¸ ëŒ€ê¸°
                window.addEventListener('firebaseReady', startApp, { once: true });
                
                // ìµœëŒ€ 2ì´ˆ í›„ ê°•ì œ ì‹œì‘
                setTimeout(() => {
                    if (document.getElementById('loadingScreen') && !document.getElementById('loadingScreen').classList.contains('hidden')) {
                        startApp();
                    }
                }, 2000);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ì‹œì‘
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', waitForFirebaseAndStart);
        } else {
            waitForFirebaseAndStart();
        }
        
        // ê°•ì œ ì‹œì‘ ë²„íŠ¼ (ë¡œë”©ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦´ ê²½ìš°)
        setTimeout(() => {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen && !loadingScreen.classList.contains('hidden')) {
                const forceStartBtn = document.createElement('button');
                forceStartBtn.innerHTML = 'ğŸš€ ë°”ë¡œ ì‹œì‘í•˜ê¸°';
                forceStartBtn.className = 'mt-4 bg-white text-purple-600 px-6 py-3 rounded-xl font-bold hover:bg-gray-100 transition-colors';
                forceStartBtn.onclick = startApp;
                loadingScreen.querySelector('.text-center').appendChild(forceStartBtn);
            }
        }, 3000);

        // ë©”ì¸ ì„ íƒ í™”ë©´ í‘œì‹œ
        function showMainSelection() {
            hideAllScreens();
            document.getElementById('mainSelectionScreen').classList.remove('hidden');
        }

        // ëª¨ë“  í™”ë©´ ìˆ¨ê¸°ê¸°
        function hideAllScreens() {
            const screens = ['mainSelectionScreen', 'teacherLoginScreen', 'teacherSetupScreen', 'teacherVerificationScreen', 'studentInfoModal', 'mainApp'];
            screens.forEach(screenId => {
                const screen = document.getElementById(screenId);
                if (screen) screen.classList.add('hidden');
            });
        }

        // êµì‚¬ ì¸ì¦ í™•ì¸
        async function checkTeacherVerification(user) {
            try {
                if (window.firebaseInitialized && window.db && window.doc && window.getDoc) {
                    const teacherRef = window.doc(window.db, 'teachers', user.uid);
                    const teacherDoc = await window.getDoc(teacherRef);
                    
                    if (teacherDoc.exists() && teacherDoc.data().verified) {
                        // ì´ë¯¸ ì¸ì¦ëœ êµì‚¬ - ë°”ë¡œ ë¡œê·¸ì¸
                        isTeacher = true;
                        isStudent = false;
                        enterMainApp();
                        showNotification(`ğŸ‘©â€ğŸ« ${user.email} ì„ ìƒë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`, 'success');
                    } else {
                        // ë¯¸ì¸ì¦ ê³„ì • - ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        await window.signOut(window.auth);
                        showMainSelection();
                        showNotification('âŒ ì¸ì¦ë˜ì§€ ì•Šì€ ê³„ì •ì…ë‹ˆë‹¤. "êµì‚¬ ê³„ì • ì„¤ì •"ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.', 'error');
                    }
                } else {
                    // Firebase ì—†ì´ ë¡œì»¬ ëª¨ë“œ - í•­ìƒ ì¸ì¦ í•„ìš”
                    showMainSelection();
                    showNotification('ğŸ”‘ ë¡œì»¬ ëª¨ë“œ: "êµì‚¬ ê³„ì • ì„¤ì •"ì„ í†µí•´ ì§„í–‰í•´ì£¼ì„¸ìš”', 'info');
                }
            } catch (error) {
                console.error('êµì‚¬ ì¸ì¦ í™•ì¸ ì˜¤ë¥˜:', error);
                showMainSelection();
                showNotification('âŒ ì¸ì¦ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // êµì‚¬ ì¸ì¦ í™”ë©´ í‘œì‹œ
        function showTeacherVerification(user) {
            hideAllScreens();
            document.getElementById('teacherVerificationScreen').classList.remove('hidden');
            document.getElementById('verificationUserEmail').textContent = user.email;
        }

        // ë©”ì¸ ì„ íƒ í™”ë©´ ë²„íŠ¼ë“¤
        document.getElementById('teacherLoginBtn').addEventListener('click', () => {
            hideAllScreens();
            document.getElementById('teacherLoginScreen').classList.remove('hidden');
        });

        document.getElementById('studentAccessBtn').addEventListener('click', () => {
            hideAllScreens();
            document.getElementById('studentInfoModal').classList.remove('hidden');
            loadYearSubjectsForStudent();
        });

        document.getElementById('teacherSetupBtn').addEventListener('click', () => {
            hideAllScreens();
            document.getElementById('teacherSetupScreen').classList.remove('hidden');
        });

        // ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ë“¤
        document.getElementById('backToMainBtn').addEventListener('click', () => {
            showMainSelection();
        });

        document.getElementById('backToMainFromSetupBtn').addEventListener('click', () => {
            showMainSelection();
        });

        // êµ¬ê¸€ ë¡œê·¸ì¸ (ê¸°ì¡´ êµì‚¬)
        document.getElementById('googleLoginBtn').addEventListener('click', async () => {
            try {
                if (window.firebaseInitialized && window.signInWithPopup && window.auth && window.provider) {
                    const result = await window.signInWithPopup(window.auth, window.provider);
                    showNotification('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                } else {
                    showNotification('âŒ Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤. ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                showNotification('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        });

        // êµ¬ê¸€ ë¡œê·¸ì¸ (ì‹ ê·œ êµì‚¬ ê°€ì…)
        document.getElementById('setupGoogleLoginBtn').addEventListener('click', async () => {
            try {
                if (window.firebaseInitialized && window.signInWithPopup && window.auth && window.provider) {
                    const result = await window.signInWithPopup(window.auth, window.provider);
                    // ì‹ ê·œ ê°€ì…ì´ë¯€ë¡œ ë°”ë¡œ ì¸ì¦ í™”ë©´ìœ¼ë¡œ
                    currentUser = result.user;
                    showTeacherVerification(result.user);
                    showNotification('âœ… êµ¬ê¸€ ê³„ì • ì—°ê²° ì„±ê³µ! ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'success');
                } else {
                    showNotification('âŒ Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤. ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                }
            } catch (error) {
                console.error('ê°€ì… ì˜¤ë¥˜:', error);
                showNotification('âŒ êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        });

        // êµì‚¬ ì¸ì¦ ì½”ë“œ í™•ì¸
        document.getElementById('verifyCodeBtn').addEventListener('click', async () => {
            const code = document.getElementById('verificationCode').value.trim();
            const verifyBtn = document.getElementById('verifyCodeBtn');
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            verifyBtn.disabled = true;
            verifyBtn.innerHTML = 'â³ ì¸ì¦ ì¤‘...';
            
            // ì¸ì¦ ì½”ë“œ í™•ì¸ (ì‹¤ì œ ì½”ë“œëŠ” ìˆ¨ê¹€)
            const validCode = 'MINAH2025';
            
            if (code === validCode) {
                try {
                    // Firebase ì—°ê²° ìƒíƒœ ì¬í™•ì¸
                    if (window.firebaseInitialized && window.db && window.doc && window.setDoc && currentUser) {
                        console.log('ğŸ”¥ Firebaseì— êµì‚¬ ì •ë³´ ì €ì¥ ì¤‘...');
                        
                        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ë° ë°ì´í„° ì €ì¥
                        try {
                            // êµì‚¬ ì •ë³´ ì €ì¥
                            const teacherRef = window.doc(window.db, 'teachers', currentUser.uid);
                            await window.setDoc(teacherRef, {
                                email: currentUser.email,
                                verified: true,
                                verifiedAt: new Date().toISOString(),
                                displayName: currentUser.displayName || currentUser.email,
                                lastLogin: new Date().toISOString()
                            });
                            
                            console.log('âœ… êµì‚¬ ì •ë³´ ì €ì¥ ì™„ë£Œ');
                            
                            // ê¸°ë³¸ í•™ë…„ë„/ìˆ˜ì—… ë°ì´í„° ìƒì„±
                            const currentYear = new Date().getFullYear();
                            const yearSubjectRef = window.doc(window.db, 'yearSubjects', currentUser.uid);
                            await window.setDoc(yearSubjectRef, {
                                years: [currentYear.toString()],
                                subjects: ['ì˜ì–´'],
                                createdAt: new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            });
                            
                            console.log('âœ… ê¸°ë³¸ í•™ë…„ë„/ìˆ˜ì—… ë°ì´í„° ìƒì„± ì™„ë£Œ');
                            
                            // ì—°ê²° í…ŒìŠ¤íŠ¸ìš© ë°ì´í„° ì €ì¥
                            const testRef = window.doc(window.db, 'connectionTest', currentUser.uid);
                            await window.setDoc(testRef, {
                                test: true,
                                timestamp: Date.now(),
                                userAgent: navigator.userAgent
                            });
                            
                            console.log('âœ… ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                            
                            showNotification('ğŸ‰ Firebase ì—°ë™ ì™„ë£Œ! ì‹¤ì‹œê°„ ë™ê¸°í™”ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                            
                            isTeacher = true;
                            isStudent = false;
                            
                            setTimeout(() => {
                                enterMainApp();
                            }, 1000);
                            
                        } catch (firebaseError) {
                            console.error('ğŸ”¥ Firebase ì €ì¥ ì˜¤ë¥˜:', firebaseError);
                            
                            // ê¶Œí•œ ì˜¤ë¥˜ì¸ ê²½ìš° ì„¤ì • ê°€ì´ë“œ í‘œì‹œ
                            if (firebaseError.code === 'permission-denied' || 
                                firebaseError.message.includes('Missing or insufficient permissions')) {
                                
                                showNotification('ğŸ”’ Firebase ê¶Œí•œ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                                
                                setTimeout(() => {
                                    showFirebaseSetupGuide();
                                }, 1000);
                                
                                // ë²„íŠ¼ ë³µì›
                                verifyBtn.disabled = false;
                                verifyBtn.innerHTML = 'âœ… ì¸ì¦í•˜ê¸°';
                                return;
                            } else {
                                // ë‹¤ë¥¸ ì˜¤ë¥˜ëŠ” ì¬ì‹œë„ ì•ˆë‚´
                                showNotification('âŒ Firebase ì—°ê²° ì˜¤ë¥˜. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”', 'error');
                                
                                // ë²„íŠ¼ ë³µì›
                                verifyBtn.disabled = false;
                                verifyBtn.innerHTML = 'âœ… ì¸ì¦í•˜ê¸°';
                                return;
                            }
                        }
                        
                    } else {
                        // Firebase ì´ˆê¸°í™” ì‹¤íŒ¨ - ì„¤ì • í™•ì¸ í•„ìš”
                        console.log('âš ï¸ Firebase ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                        showNotification('ğŸ”§ Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”', 'warning');
                        
                        setTimeout(() => {
                            showFirebaseSetupGuide();
                        }, 1000);
                        
                        // ë²„íŠ¼ ë³µì›
                        verifyBtn.disabled = false;
                        verifyBtn.innerHTML = 'âœ… ì¸ì¦í•˜ê¸°';
                        return;
                    }
                    
                } catch (error) {
                    console.error('ì¸ì¦ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    showNotification('âŒ ì¸ì¦ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                    
                    // ë²„íŠ¼ ë³µì›
                    verifyBtn.disabled = false;
                    verifyBtn.innerHTML = 'âœ… ì¸ì¦í•˜ê¸°';
                    return;
                }
            } else {
                showNotification('âŒ ì¸ì¦ ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
                document.getElementById('verificationCode').value = '';
                document.getElementById('verificationCode').focus();
                
                // ë²„íŠ¼ ë³µì›
                verifyBtn.disabled = false;
                verifyBtn.innerHTML = 'âœ… ì¸ì¦í•˜ê¸°';
            }
        });

        // ì¸ì¦ ì·¨ì†Œ
        document.getElementById('cancelVerificationBtn').addEventListener('click', async () => {
            try {
                if (window.firebaseInitialized && window.signOut && window.auth) {
                    await window.signOut(window.auth);
                }
            } catch (error) {
                console.log('ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬:', error);
            }
            currentUser = null;
            showMainSelection();
            showNotification('âŒ ì¸ì¦ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
        });

        // í•™ìƒ ì •ë³´ ì…ë ¥
        document.getElementById('studentInfoSubmit').addEventListener('click', async () => {
            const year = document.getElementById('studentYearSelect').value;
            const subject = document.getElementById('studentSubjectSelect').value;
            const className = document.getElementById('studentClassSelect').value;
            const number = parseInt(document.getElementById('studentNumber').value);
            const name = document.getElementById('studentName').value.trim();

            if (!year || !subject || !className || !number || !name) {
                showNotification('âŒ ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            try {
                const student = await findStudent(year, subject, className, number, name);
                if (student) {
                    isStudent = true;
                    isTeacher = false;
                    currentStudent = student;
                    currentYear = year;
                    currentSubject = subject;
                    currentClass = className;
                    
                    document.getElementById('studentInfoModal').classList.add('hidden');
                    enterMainApp();
                    showNotification(`ğŸ‘¨â€ğŸ“ ${name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`, 'success');
                } else {
                    showNotification('âŒ í•™ë²ˆê³¼ ì´ë¦„ì´ ì¼ì¹˜í•˜ëŠ” í•™ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('í•™ìƒ ì°¾ê¸° ì˜¤ë¥˜:', error);
                showNotification('âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        });

        document.getElementById('studentInfoCancel').addEventListener('click', () => {
            document.getElementById('studentInfoModal').classList.add('hidden');
            showMainSelection();
        });

        // ë©”ì¸ ì•± ì§„ì…
        function enterMainApp() {
            document.getElementById('roleSelectionScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            if (isTeacher) {
                setupTeacherInterface();
            } else if (isStudent) {
                setupStudentInterface();
            }
            
            initializeApp();
        }

        // ì„ ìƒë‹˜ ì¸í„°í˜ì´ìŠ¤ ì„¤ì •
        function setupTeacherInterface() {
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('md:ml-56');
            document.getElementById('teacherSections').classList.remove('hidden');
            document.getElementById('studentViewSection').classList.add('hidden');
            document.getElementById('userInfo').textContent = `ğŸ‘©â€ğŸ« ${currentUser?.email || 'Teacher'}`;
            document.getElementById('welcomeText').textContent = 'í•™ë…„ë„, ìˆ˜ì—…, ë°˜ì„ ì„ íƒí•˜ì—¬ í¬ì¸íŠ¸ ê´€ë¦¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”!';
        }

        // í•™ìƒ ì¸í„°í˜ì´ìŠ¤ ì„¤ì •
        function setupStudentInterface() {
            document.getElementById('sidebar').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('md:ml-56');
            document.getElementById('teacherSections').classList.add('hidden');
            document.getElementById('studentViewSection').classList.remove('hidden');
            document.getElementById('welcomeMessage').classList.add('hidden');
            document.getElementById('userInfo').textContent = `ğŸ‘¨â€ğŸ“ ${currentStudent?.name} (${currentStudent?.number}ë²ˆ)`;
            
            showStudentView();
            setupStudentRealTimeUpdates();
        }

        // ë¡œê·¸ì•„ì›ƒ
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // Firebase ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
                    unsubscribeListeners.forEach(unsubscribe => unsubscribe());
                    unsubscribeListeners = [];
                    
                    if (window.signOut && window.auth) {
                        await window.signOut(window.auth);
                    }
                    
                    // ìƒíƒœ ì´ˆê¸°í™”
                    currentUser = null;
                    isTeacher = false;
                    isStudent = false;
                    currentStudent = null;
                    currentYear = '';
                    currentSubject = '';
                    currentClass = '';
                    
                    showNotification('ğŸ‘‹ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                    showNotification('âŒ ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                }
            }
        });

        // ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            notification.className = `notification ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">âœ•</button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => notification.classList.add('show'), 100);
            
            // ìë™ ì œê±°
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // ë‹¤í¬ëª¨ë“œ í† ê¸€
        document.getElementById('darkModeToggle').addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.getElementById('darkModeToggle').innerHTML = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('darkMode', isDarkMode);
        });

        // ë‹¤í¬ëª¨ë“œ ì„¤ì • ë¡œë“œ
        if (localStorage.getItem('darkMode') === 'true') {
            isDarkMode = true;
            document.body.classList.add('dark-mode');
            document.getElementById('darkModeToggle').innerHTML = 'â˜€ï¸';
        }

        // Firebase ë°ì´í„° í•¨ìˆ˜ë“¤
        async function findStudent(year, subject, className, number, name) {
            try {
                if (window.db && window.doc && window.getDoc) {
                    const docRef = window.doc(window.db, 'classes', `${year}-${subject}-${className}`);
                    const docSnap = await window.getDoc(docRef);
                    
                    if (docSnap.exists()) {
                        const students = docSnap.data().students || [];
                        return students.find(s => s.number === number && s.name === name);
                    }
                }
                return null;
            } catch (error) {
                console.error('í•™ìƒ ì°¾ê¸° ì˜¤ë¥˜:', error);
                return null;
            }
        }

        async function loadYearSubjectsForStudent() {
            // í•™ë…„ë„ ë° ìˆ˜ì—… ë¡œë“œ ë¡œì§
            const yearSelect = document.getElementById('studentYearSelect');
            const subjectSelect = document.getElementById('studentSubjectSelect');
            
            yearSelect.innerHTML = '<option value="">í•™ë…„ë„ ì„ íƒ</option>';
            subjectSelect.innerHTML = '<option value="">ìˆ˜ì—… ì„ íƒ</option>';
            
            // ê¸°ë³¸ê°’ ì¶”ê°€ (ì‹¤ì œë¡œëŠ” Firebaseì—ì„œ ë¡œë“œ)
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML += `<option value="${currentYear}">${currentYear}</option>`;
            
            yearSelect.addEventListener('change', () => {
                const selectedYear = yearSelect.value;
                subjectSelect.innerHTML = '<option value="">ìˆ˜ì—… ì„ íƒ</option>';
                if (selectedYear) {
                    subjectSelect.innerHTML += '<option value="ì˜ì–´">ì˜ì–´</option>';
                }
            });
        }

        // í•™ìƒ ë·° í‘œì‹œ
        function showStudentView() {
            if (!currentStudent) return;
            
            const studentIndex = Math.floor(Math.random() * avatars.length);
            const totalPoints = currentStudent.points?.reduce((sum, p) => sum + p.value, 0) || 0;
            
            document.getElementById('studentInfo').innerHTML = `
                <div class="mb-6">${avatars[studentIndex]}</div>
                <h3 class="text-2xl font-bold text-green-600 mb-4">${currentStudent.number}ë²ˆ ${currentStudent.name}</h3>
                <div class="bg-gradient-to-r from-green-400 to-blue-500 text-white rounded-full px-8 py-4 font-bold text-3xl mb-6 point-animation">
                    â­ ${totalPoints}ì 
                </div>
                
                <div class="text-left max-w-2xl mx-auto">
                    <h4 class="text-xl font-bold text-purple-600 mb-4">ğŸ“‹ í¬ì¸íŠ¸ ë‚´ì—­</h4>
                    ${!currentStudent.points || currentStudent.points.length === 0 ? 
                        '<p class="text-gray-500 text-center py-8">ì•„ì§ í¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' :
                        `<div class="space-y-3 max-h-96 overflow-y-auto">
                            ${currentStudent.points.map(point => `
                                <div class="bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition-colors">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-semibold text-purple-600">${point.category}</span>
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full font-bold">+${point.value}ì </span>
                                    </div>
                                    ${point.description ? `<p class="text-gray-600 mb-2">${point.description}</p>` : ''}
                                    <p class="text-gray-400 text-sm">${new Date(point.date).toLocaleString('ko-KR')}</p>
                                </div>
                            `).join('')}
                        </div>`
                    }
                </div>
            `;
        }

        // í•™ìƒìš© ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì„¤ì •
        function setupStudentRealTimeUpdates() {
            if (!window.db || !currentStudent) return;
            
            try {
                const docRef = window.doc(window.db, 'classes', `${currentYear}-${currentSubject}-${currentClass}`);
                const unsubscribe = window.onSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        const students = data.students || [];
                        const updatedStudent = students.find(s => s.number === currentStudent.number && s.name === currentStudent.name);
                        
                        if (updatedStudent) {
                            currentStudent = updatedStudent;
                            showStudentView();
                            updateStudentRanking();
                        }
                    }
                });
                
                unsubscribeListeners.push(unsubscribe);
            } catch (error) {
                console.error('ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì„¤ì • ì˜¤ë¥˜:', error);
            }
        }

        // í•™ìƒ ë­í‚¹ ì—…ë°ì´íŠ¸
        function updateStudentRanking() {
            // ë­í‚¹ ë¡œì§ êµ¬í˜„
            const rankingDiv = document.getElementById('studentRanking');
            if (rankingDiv) {
                rankingDiv.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-2xl font-bold text-orange-600">ğŸ† ë‚´ ìˆœìœ„: ê³„ì‚° ì¤‘...</div>
                        <p class="text-gray-500 mt-2">ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // ì•± ì´ˆê¸°í™”
        function initializeApp() {
            // ë©”ë‰´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupMenuListeners();
            
            // ëª¨ë°”ì¼ ë©”ë‰´ ì„¤ì •
            setupMobileMenu();
            
            // í¬ì¸íŠ¸ ê´€ë¦¬ ì„¤ì •
            setupPointManagement();
            
            // ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ
            if (isTeacher) {
                loadYearSubjects();
            }
        }

        // ë©”ë‰´ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupMenuListeners() {
            const menuItems = [
                { id: 'menuPoints', section: 'points' },
                { id: 'menuDashboard', section: 'dashboard' },
                { id: 'menuDetails', section: 'details' },
                { id: 'menuRewards', section: 'rewards' },
                { id: 'menuStudents', section: 'students' },
                { id: 'menuSettings', section: 'settings' }
            ];

            menuItems.forEach(item => {
                const element = document.getElementById(item.id);
                if (element) {
                    element.addEventListener('click', () => showSection(item.section));
                }
            });
        }

        // ì„¹ì…˜ í‘œì‹œ
        function showSection(section) {
            if (!isTeacher) return;
            
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const sections = ['pointsSection', 'dashboardSection', 'detailsSection', 'rewardsSection', 'studentsSection', 'settingsSection'];
            sections.forEach(sectionId => {
                const sectionEl = document.getElementById(sectionId);
                if (sectionEl) sectionEl.classList.add('hidden');
            });
            
            document.getElementById('welcomeMessage').classList.add('hidden');
            
            // ë©”ë‰´ í™œì„±í™” ìƒíƒœ ì œê±°
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            const sectionEl = document.getElementById(section + 'Section');
            const menuEl = document.getElementById('menu' + section.charAt(0).toUpperCase() + section.slice(1));
            
            if (sectionEl) sectionEl.classList.remove('hidden');
            if (menuEl) menuEl.classList.add('active');
            
            currentView = section;
            
            // ì„¹ì…˜ë³„ ì´ˆê¸°í™”
            if (section === 'dashboard') {
                initializeDashboard();
            } else if (section === 'details') {
                loadStudentDetails();
            }
        }

        // ëª¨ë°”ì¼ ë©”ë‰´ ì„¤ì •
        function setupMobileMenu() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('-translate-x-full');
                    sidebarOverlay.classList.toggle('hidden');
                });
            }

            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', () => {
                    sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('hidden');
                });
            }
        }

        // í¬ì¸íŠ¸ ê´€ë¦¬ ì„¤ì •
        function setupPointManagement() {
            // ì„ íƒ ëª¨ë“œ í† ê¸€
            const selectionModeRadios = document.querySelectorAll('input[name="selectionMode"]');
            selectionModeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const singleMode = document.getElementById('singleMode');
                    const multipleMode = document.getElementById('multipleMode');
                    
                    if (e.target.value === 'single') {
                        singleMode.classList.remove('hidden');
                        multipleMode.classList.add('hidden');
                    } else {
                        singleMode.classList.add('hidden');
                        multipleMode.classList.remove('hidden');
                    }
                });
            });

            // ë¹ ë¥¸ í¬ì¸íŠ¸ ë²„íŠ¼
            document.querySelectorAll('.quick-point-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const points = e.target.dataset.points;
                    const pointValueInput = document.getElementById('pointValue');
                    const pointValueMultipleInput = document.getElementById('pointValueMultiple');
                    
                    if (pointValueInput && !pointValueInput.closest('#multipleMode').classList.contains('hidden')) {
                        pointValueInput.value = points;
                    }
                    if (pointValueMultipleInput && !pointValueMultipleInput.closest('#multipleMode').classList.contains('hidden')) {
                        pointValueMultipleInput.value = points;
                    }
                });
            });

            // í¬ì¸íŠ¸ ì¶”ê°€ ë²„íŠ¼
            const addPointBtn = document.getElementById('addPointBtn');
            if (addPointBtn) {
                addPointBtn.addEventListener('click', addPoints);
            }
        }

        // í¬ì¸íŠ¸ ì¶”ê°€ í•¨ìˆ˜
        async function addPoints() {
            const selectionMode = document.querySelector('input[name="selectionMode"]:checked').value;
            const category = document.getElementById('pointCategory').value;
            const description = document.getElementById('pointDescription').value;
            
            if (!category) {
                showNotification('âŒ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            try {
                if (selectionMode === 'single') {
                    const studentId = document.getElementById('studentSelect').value;
                    const pointValue = parseInt(document.getElementById('pointValue').value);
                    
                    if (!studentId || !pointValue) {
                        showNotification('âŒ í•™ìƒê³¼ í¬ì¸íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                        return;
                    }
                    
                    await addPointToStudent(studentId, pointValue, category, description);
                } else {
                    const selectedStudents = Array.from(document.querySelectorAll('#studentCheckboxList input:checked'))
                        .map(cb => cb.value);
                    const pointValue = parseInt(document.getElementById('pointValueMultiple').value);
                    
                    if (selectedStudents.length === 0 || !pointValue) {
                        showNotification('âŒ í•™ìƒë“¤ê³¼ í¬ì¸íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                        return;
                    }
                    
                    for (const studentId of selectedStudents) {
                        await addPointToStudent(studentId, pointValue, category, description);
                    }
                }
                
                showNotification('ğŸ‰ í¬ì¸íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('pointDescription').value = '';
                document.getElementById('pointValue').value = '';
                document.getElementById('pointValueMultiple').value = '';
                
            } catch (error) {
                console.error('í¬ì¸íŠ¸ ì¶”ê°€ ì˜¤ë¥˜:', error);
                showNotification('âŒ í¬ì¸íŠ¸ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ê°œë³„ í•™ìƒì—ê²Œ í¬ì¸íŠ¸ ì¶”ê°€
        async function addPointToStudent(studentNumber, pointValue, category, description) {
            if (!currentYear || !currentSubject || !currentClass) {
                throw new Error('í•™ë…„ë„, ìˆ˜ì—…, ë°˜ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”');
            }
            
            const classKey = `${currentYear}-${currentSubject}-${currentClass}`;
            const pointData = {
                value: pointValue,
                category: category,
                description: description || '',
                date: new Date().toISOString(),
                addedBy: currentUser?.email || 'teacher'
            };
            
            try {
                if (window.firebaseInitialized && window.db && window.doc && window.getDoc && window.updateDoc) {
                    // Firebaseì—ì„œ ì²˜ë¦¬
                    const classRef = window.doc(window.db, 'classes', classKey);
                    const docSnap = await window.getDoc(classRef);
                    
                    if (docSnap.exists()) {
                        const classData = docSnap.data();
                        const students = classData.students || [];
                        
                        // í•´ë‹¹ í•™ìƒ ì°¾ê¸°
                        const studentIndex = students.findIndex(s => s.number === parseInt(studentNumber));
                        if (studentIndex !== -1) {
                            // í¬ì¸íŠ¸ ì¶”ê°€
                            if (!students[studentIndex].points) {
                                students[studentIndex].points = [];
                            }
                            students[studentIndex].points.push(pointData);
                            
                            // Firebase ì—…ë°ì´íŠ¸
                            await window.updateDoc(classRef, {
                                students: students,
                                lastUpdated: new Date().toISOString()
                            });
                            
                            console.log(`âœ… Firebase: ${students[studentIndex].name}ì—ê²Œ ${pointValue}ì  ì¶”ê°€`);
                        } else {
                            throw new Error('í•™ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        }
                    }
                } else {
                    // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ì²˜ë¦¬
                    const localKey = `students_${classKey}`;
                    const savedStudents = JSON.parse(localStorage.getItem(localKey) || '[]');
                    
                    const studentIndex = savedStudents.findIndex(s => s.number === parseInt(studentNumber));
                    if (studentIndex !== -1) {
                        if (!savedStudents[studentIndex].points) {
                            savedStudents[studentIndex].points = [];
                        }
                        savedStudents[studentIndex].points.push(pointData);
                        
                        localStorage.setItem(localKey, JSON.stringify(savedStudents));
                        console.log(`âœ… ë¡œì»¬: ${savedStudents[studentIndex].name}ì—ê²Œ ${pointValue}ì  ì¶”ê°€`);
                        
                        // ë¡œì»¬ ëª¨ë“œì—ì„œëŠ” ìˆ˜ë™ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸
                        updateStudentSelects(savedStudents);
                        updateQuickStats(savedStudents);
                    } else {
                        throw new Error('í•™ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    }
                }
            } catch (error) {
                console.error('í¬ì¸íŠ¸ ì¶”ê°€ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // í•™ë…„ë„/ìˆ˜ì—… ë¡œë“œ
        async function loadYearSubjects() {
            const yearSelect = document.getElementById('yearSelect');
            const subjectSelect = document.getElementById('subjectSelect');
            
            if (!yearSelect || !currentUser) return;
            
            try {
                if (window.firebaseInitialized && window.db && window.doc && window.getDoc) {
                    // Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ
                    const yearSubjectRef = window.doc(window.db, 'yearSubjects', currentUser.uid);
                    const docSnap = await window.getDoc(yearSubjectRef);
                    
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const years = data.years || [];
                        const subjects = data.subjects || [];
                        
                        // í•™ë…„ë„ ì˜µì…˜ ì¶”ê°€
                        yearSelect.innerHTML = '<option value="">í•™ë…„ë„ ì„ íƒ</option>';
                        years.forEach(year => {
                            yearSelect.innerHTML += `<option value="${year}">${year}</option>`;
                        });
                        
                        // ìˆ˜ì—… ì˜µì…˜ ë¯¸ë¦¬ ë¡œë“œ
                        subjectSelect.innerHTML = '<option value="">ìˆ˜ì—… ì„ íƒ</option>';
                        subjects.forEach(subject => {
                            subjectSelect.innerHTML += `<option value="${subject}">${subject}</option>`;
                        });
                    } else {
                        // ê¸°ë³¸ ë°ì´í„° ìƒì„±
                        const currentYear = new Date().getFullYear();
                        await window.setDoc(yearSubjectRef, {
                            years: [currentYear.toString()],
                            subjects: ['ì˜ì–´'],
                            createdAt: new Date().toISOString()
                        });
                        
                        yearSelect.innerHTML = '<option value="">í•™ë…„ë„ ì„ íƒ</option>';
                        yearSelect.innerHTML += `<option value="${currentYear}">${currentYear}</option>`;
                        
                        subjectSelect.innerHTML = '<option value="">ìˆ˜ì—… ì„ íƒ</option>';
                        subjectSelect.innerHTML += '<option value="ì˜ì–´">ì˜ì–´</option>';
                    }
                } else {
                    // ë¡œì»¬ ëª¨ë“œ
                    const currentYear = new Date().getFullYear();
                    yearSelect.innerHTML = '<option value="">í•™ë…„ë„ ì„ íƒ</option>';
                    yearSelect.innerHTML += `<option value="${currentYear}">${currentYear}</option>`;
                    
                    subjectSelect.innerHTML = '<option value="">ìˆ˜ì—… ì„ íƒ</option>';
                    subjectSelect.innerHTML += '<option value="ì˜ì–´">ì˜ì–´</option>';
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                yearSelect.addEventListener('change', (e) => {
                    currentYear = e.target.value;
                    updateClassSelect();
                });
                
                subjectSelect.addEventListener('change', (e) => {
                    currentSubject = e.target.value;
                    updateClassSelect();
                });
                
                // ë°˜ ì„ íƒ ì´ë²¤íŠ¸
                const classSelect = document.getElementById('classSelect');
                if (classSelect) {
                    classSelect.addEventListener('change', (e) => {
                        currentClass = e.target.value;
                        if (currentYear && currentSubject && currentClass) {
                            loadStudentsForClass();
                        }
                    });
                }
                
            } catch (error) {
                console.error('í•™ë…„ë„/ìˆ˜ì—… ë¡œë“œ ì˜¤ë¥˜:', error);
                showNotification('âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ë°˜ ì„ íƒ ì—…ë°ì´íŠ¸
        function updateClassSelect() {
            const classSelect = document.getElementById('classSelect');
            if (classSelect && currentYear && currentSubject) {
                // ë°˜ ì„ íƒ í™œì„±í™”
                classSelect.disabled = false;
                showNotification(`ğŸ“š ${currentYear}ë…„ë„ ${currentSubject} ìˆ˜ì—…ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`, 'info');
            }
        }

        // ì„ íƒëœ ë°˜ì˜ í•™ìƒë“¤ ë¡œë“œ
        async function loadStudentsForClass() {
            if (!currentYear || !currentSubject || !currentClass) return;
            
            try {
                const classKey = `${currentYear}-${currentSubject}-${currentClass}`;
                
                if (window.firebaseInitialized && window.db && window.doc && window.getDoc) {
                    // Firebaseì—ì„œ í•™ìƒ ë°ì´í„° ë¡œë“œ
                    const classRef = window.doc(window.db, 'classes', classKey);
                    const docSnap = await window.getDoc(classRef);
                    
                    if (docSnap.exists()) {
                        const classData = docSnap.data();
                        const students = classData.students || [];
                        
                        updateStudentSelects(students);
                        updateQuickStats(students);
                        
                        // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                        setupRealtimeListener(classKey);
                        
                        showNotification(`ğŸ‘¥ ${students.length}ëª…ì˜ í•™ìƒ ë°ì´í„°ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤`, 'success');
                    } else {
                        // ìƒˆ ë°˜ ìƒì„±
                        await window.setDoc(classRef, {
                            year: currentYear,
                            subject: currentSubject,
                            className: currentClass,
                            students: [],
                            createdAt: new Date().toISOString(),
                            createdBy: currentUser.uid
                        });
                        
                        updateStudentSelects([]);
                        updateQuickStats([]);
                        showNotification(`ğŸ“ ìƒˆë¡œìš´ ë°˜ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${currentClass}`, 'info');
                    }
                } else {
                    // ë¡œì»¬ ëª¨ë“œ
                    const localKey = `students_${classKey}`;
                    const savedStudents = JSON.parse(localStorage.getItem(localKey) || '[]');
                    
                    updateStudentSelects(savedStudents);
                    updateQuickStats(savedStudents);
                    showNotification(`ğŸ’¾ ë¡œì»¬ ë°ì´í„°ì—ì„œ ${savedStudents.length}ëª… ë¡œë“œ`, 'info');
                }
                
            } catch (error) {
                console.error('í•™ìƒ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showNotification('âŒ í•™ìƒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupRealtimeListener(classKey) {
            if (!window.firebaseInitialized || !window.db || !window.onSnapshot) return;
            
            try {
                const classRef = window.doc(window.db, 'classes', classKey);
                const unsubscribe = window.onSnapshot(classRef, (doc) => {
                    if (doc.exists()) {
                        const classData = doc.data();
                        const students = classData.students || [];
                        
                        updateStudentSelects(students);
                        updateQuickStats(students);
                        
                        // ëŒ€ì‹œë³´ë“œê°€ ì—´ë ¤ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
                        if (currentView === 'dashboard') {
                            updateDashboardStats();
                        }
                    }
                });
                
                // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ í›„ ìƒˆ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                unsubscribeListeners.forEach(unsub => unsub());
                unsubscribeListeners = [unsubscribe];
                
            } catch (error) {
                console.error('ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì˜¤ë¥˜:', error);
            }
        }

        // í•™ìƒ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateStudentSelects(students) {
            const studentSelect = document.getElementById('studentSelect');
            const studentCheckboxList = document.getElementById('studentCheckboxList');
            
            if (studentSelect) {
                studentSelect.innerHTML = '<option value="">í•™ìƒ ì„ íƒ</option>';
                students.forEach(student => {
                    studentSelect.innerHTML += `<option value="${student.number}">${student.number}ë²ˆ ${student.name}</option>`;
                });
            }
            
            if (studentCheckboxList) {
                studentCheckboxList.innerHTML = '';
                students.forEach(student => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center space-x-2 p-2 hover:bg-purple-50 rounded';
                    div.innerHTML = `
                        <input type="checkbox" value="${student.number}" id="student_${student.number}" class="student-checkbox">
                        <label for="student_${student.number}" class="flex-1 cursor-pointer">${student.number}ë²ˆ ${student.name}</label>
                    `;
                    studentCheckboxList.appendChild(div);
                });
                
                // ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
                setupStudentSearch(students);
            }
        }

        // í•™ìƒ ê²€ìƒ‰ ê¸°ëŠ¥
        function setupStudentSearch(students) {
            const searchInput = document.getElementById('studentSearchInput');
            if (!searchInput) return;
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const checkboxes = document.querySelectorAll('#studentCheckboxList > div');
                
                checkboxes.forEach(div => {
                    const label = div.querySelector('label').textContent.toLowerCase();
                    if (label.includes(searchTerm)) {
                        div.style.display = 'flex';
                    } else {
                        div.style.display = 'none';
                    }
                });
            });
        }

        // ë¹ ë¥¸ í†µê³„ ì—…ë°ì´íŠ¸
        function updateQuickStats(students) {
            const totalStudentsCount = document.getElementById('totalStudentsCount');
            const totalPointsCount = document.getElementById('totalPointsCount');
            
            if (totalStudentsCount) {
                totalStudentsCount.textContent = students.length;
            }
            
            if (totalPointsCount) {
                const totalPoints = students.reduce((sum, student) => {
                    return sum + (student.points?.reduce((pSum, point) => pSum + point.value, 0) || 0);
                }, 0);
                totalPointsCount.textContent = totalPoints;
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        function initializeDashboard() {
            // ì‹¤ì‹œê°„ í†µê³„ ì—…ë°ì´íŠ¸
            updateDashboardStats();
            
            // ì°¨íŠ¸ ì´ˆê¸°í™” (Chart.js ë“± ì‚¬ìš©)
            // initializeCharts();
        }

        // ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
        function updateDashboardStats() {
            // ì‹¤ì œ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
            document.getElementById('dashTotalStudents').textContent = '0';
            document.getElementById('dashTotalPoints').textContent = '0';
            document.getElementById('dashAvgPoints').textContent = '0';
            document.getElementById('dashTodayActivity').textContent = '0';
        }

        // í•™ìƒ ìƒì„¸ ì •ë³´ ë¡œë“œ
        function loadStudentDetails() {
            const studentDetails = document.getElementById('studentDetails');
            if (studentDetails) {
                studentDetails.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-4xl mb-4">ğŸ“Š</div>
                        <h3 class="text-xl font-bold text-gray-600">í•™ìƒ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</h3>
                        <p class="text-gray-500">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                    </div>
                `;
            }
        }

        // Firebase ì˜¤ë¥˜ ëª¨ë‹¬ í‘œì‹œ
        function showFirebaseErrorModal() {
            // ì´ë¯¸ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            if (document.querySelector('.firebase-error-modal')) return;
            
            const errorModal = document.createElement('div');
            errorModal.className = 'firebase-error-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            errorModal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md mx-4 shadow-2xl">
                    <div class="text-center mb-6">
                        <div class="text-4xl mb-3">âš ï¸</div>
                        <h2 class="text-xl font-bold text-orange-600 mb-2">Firebase ì—°ê²° ì˜¤ë¥˜ ê°ì§€</h2>
                        <p class="text-gray-600 text-sm">ì‹¤ì‹œê°„ ë™ê¸°í™”ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤</p>
                    </div>
                    
                    <div class="space-y-3 text-sm mb-6">
                        <div class="bg-red-50 p-3 rounded-lg">
                            <p class="text-red-700"><strong>í˜„ì¬ ìƒí™©:</strong> Firebase ì„œë²„ ì—°ê²°ì— ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
                        </div>
                        
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="text-blue-700"><strong>í•´ê²° ë°©ë²•:</strong></p>
                            <ul class="list-disc list-inside mt-1 space-y-1">
                                <li>Firebase ë³´ì•ˆ ê·œì¹™ ì„¤ì •</li>
                                <li>ë˜ëŠ” ë¡œì»¬ ëª¨ë“œë¡œ ê³„ì† ì‚¬ìš©</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <button onclick="this.closest('.firebase-error-modal').remove(); showFirebaseSetupGuide();" 
                                class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition-colors">
                            ğŸ”§ Firebase ì„¤ì •í•˜ê¸°
                        </button>
                        <button onclick="this.closest('.firebase-error-modal').remove(); continueWithLocalMode();" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors">
                            ğŸ’¾ ë¡œì»¬ ëª¨ë“œë¡œ ê³„ì†
                        </button>
                        <button onclick="this.closest('.firebase-error-modal').remove();" 
                                class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-xl font-semibold transition-colors">
                            âœ• ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(errorModal);
        }

        // Firebase ì„¤ì • ê°€ì´ë“œ í‘œì‹œ
        function showFirebaseSetupGuide() {
            const guideModal = document.createElement('div');
            guideModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            guideModal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-3xl mx-4 max-h-[90vh] overflow-y-auto">
                    <h2 class="text-2xl font-bold text-red-600 mb-4">ğŸ”’ Firebase ë³´ì•ˆ ê·œì¹™ ì„¤ì • í•„ìš”</h2>
                    
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                        <h3 class="font-bold text-red-800 mb-2">âš ï¸ í˜„ì¬ ìƒí™©:</h3>
                        <p class="text-red-700">Firebase Firestore ë°ì´í„°ë² ì´ìŠ¤ì— ì“°ê¸° ê¶Œí•œì´ ì—†ì–´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                    
                    <div class="space-y-4 text-sm">
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h3 class="font-bold text-yellow-800 mb-3">ğŸ“‹ í•´ê²° ë°©ë²• (5ë¶„ ì†Œìš”):</h3>
                            <ol class="list-decimal list-inside space-y-3 text-yellow-700">
                                <li><strong>Firebase Console</strong> ì ‘ì†: <a href="https://console.firebase.google.com" target="_blank" class="text-blue-600 underline">console.firebase.google.com</a></li>
                                <li><strong>í”„ë¡œì íŠ¸ ì„ íƒ:</strong> "minah-teacher-s-class-points" í´ë¦­</li>
                                <li><strong>Authentication ì„¤ì •:</strong>
                                    <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                        <li>ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "Authentication" í´ë¦­</li>
                                        <li>"Sign-in method" íƒ­ í´ë¦­</li>
                                        <li>"Google" ì œê³µì—…ì²´ í™œì„±í™”</li>
                                    </ul>
                                </li>
                                <li><strong>Firestore ê·œì¹™ ì„¤ì •:</strong>
                                    <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                        <li>ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "Firestore Database" í´ë¦­</li>
                                        <li>"ê·œì¹™" íƒ­ í´ë¦­</li>
                                        <li>ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°</li>
                                        <li><strong>"ê²Œì‹œ" ë²„íŠ¼ í´ë¦­</strong> (ì¤‘ìš”!)</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-bold text-gray-800">ğŸ“ ë³µì‚¬í•  ê·œì¹™ ì½”ë“œ:</h4>
                                <button onclick="navigator.clipboard.writeText(this.nextElementSibling.textContent); showNotification('ğŸ“‹ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');" 
                                        class="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600">
                                    ğŸ“‹ ë³µì‚¬
                                </button>
                            </div>
                            <pre class="text-xs overflow-x-auto bg-white p-3 rounded border"><code>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}</code></pre>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-green-800 mb-2">âœ… ì„¤ì • ì™„ë£Œ í›„:</h4>
                            <p class="text-green-700">ê·œì¹™ì´ ì ìš©ë˜ë©´ ì‹¤ì‹œê°„ ë™ê¸°í™”ê°€ ëª¨ë“  ê¸°ê¸°ì—ì„œ ì™„ë²½í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤!</p>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-2">ğŸ’¡ ì°¸ê³ ì‚¬í•­:</h4>
                            <ul class="text-blue-700 space-y-1">
                                <li>â€¢ ì´ ì„¤ì •ì€ í•œ ë²ˆë§Œ í•˜ë©´ ë©ë‹ˆë‹¤</li>
                                <li>â€¢ ì„¤ì • í›„ ëª¨ë“  ê¸°ê¸°ì—ì„œ ì‹¤ì‹œê°„ ë™ê¸°í™” ê°€ëŠ¥</li>
                                <li>â€¢ êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mt-6">
                        <button onclick="window.open('https://console.firebase.google.com/project/minah-teacher-s-class-points/firestore/rules', '_blank')" 
                                class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold">
                            ğŸš€ Firebase Console ì—´ê¸°
                        </button>
                        <button onclick="this.closest('.fixed').remove(); location.reload();" 
                                class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold">
                            âœ… ì„¤ì • ì™„ë£Œ í›„ ìƒˆë¡œê³ ì¹¨
                        </button>
                        <button onclick="this.closest('.fixed').remove(); continueWithLocalMode();" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-xl font-semibold">
                            ğŸ’¾ ë¡œì»¬ ëª¨ë“œë¡œ ê³„ì†
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(guideModal);
        }
        
        // ë¡œì»¬ ëª¨ë“œë¡œ ê³„ì† ì§„í–‰
        function continueWithLocalMode() {
            localStorage.setItem('teacherVerified', 'true');
            localStorage.setItem('teacherEmail', 'teacher@local.com');
            currentUser = { email: 'teacher@local.com', uid: 'local-teacher' };
            isTeacher = true;
            isStudent = false;
            
            showNotification('ğŸ’¾ ë¡œì»¬ ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
            setTimeout(() => {
                enterMainApp();
            }, 500);
        }
        
        // ì½ê¸° ì „ìš© ëª¨ë“œë¡œ ê³„ì† ì§„í–‰
        function continueWithReadOnlyMode() {
            if (currentUser) {
                isTeacher = true;
                isStudent = false;
                window.firebaseReadOnly = true;
                
                showNotification('ğŸ‘€ ì½ê¸° ì „ìš© ëª¨ë“œë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.', 'warning');
                setTimeout(() => {
                    enterMainApp();
                }, 500);
            } else {
                showNotification('âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸŒŸ Minah Teacher\'s Class Points ì‹œì‘!');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9709511de0add1e2',t:'MTc1NTQzNTIzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
